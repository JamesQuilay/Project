{% extends "base.html" %}
{% block content %}

<nav class="navbar navbar-expand-lg navbar-light bg-light border-bottom">
  <div class="container">

    <ul class="nav nav-tabs justify-content-center" style="justify-content: center;">
      {% if current_user.is_authenticated %}
        <li class="nav-item">
            <a class="nav-link" aria-current="page" href="/profile">Account: {{ current_user.first_name + " " + current_user.last_name }}</a>
        </li>
      {% else %}
      <li class="nav-item">
        <a class="nav-link" href="/login">Account: Guest</a>
      </li>
      {% endif %}
    </ul>

    {% if current_user.is_authenticated %}
        <a href="/cart" class="btn btn-success">
            <img src="../static/images/cart-fill.svg" alt="Icon" style="width: 16px; height: 16px; filter: invert(1);"> {{ cart_count }} Items In Your Cart
        </a>
    {% else %}
        <a href="/login" class="btn btn-success">
            <img src="../static/images/cart-fill.svg" alt="Icon" style="width: 16px; height: 16px; filter: invert(1);"> {{ cart_count }} Items In Your Cart
        </a>
    {% endif %}
    
  </div>
</nav>

<!-- Carousel Section -->
 
<div id="carouselExampleCaptions" class="carousel slide" data-bs-ride="carousel">
  <div class="carousel-indicators">
    <button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
    <button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="1" aria-label="Slide 2"></button>
    <button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="2" aria-label="Slide 3"></button>
  </div>
  <div class="carousel-inner">
    <div class="carousel-item active">
      <img src="../static/images/luxury_watch.jpg" class="d-block w-100" alt="...">
      <div class="carousel-caption d-none d-md-block">
        <h5>Luxury Watch</h5>
        <p>Discover the pinnacle of sophistication with our Luxury Watch collection. Each timepiece is crafted with meticulous attention to detail, featuring premium materials and intricate designs. Perfect for those who appreciate the finer things in life.</p>
      </div>
    </div>
    <div class="carousel-item">
      <img src="../static/images/sport_watch.webp" class="d-block w-100" alt="...">
      <div class="carousel-caption d-none d-md-block">
        <h5>Sport Watch</h5>
        <p>Embrace your active lifestyle with our Sport Watch range. Engineered for precision and durability, these watches are perfect for athletes and adventurers alike. Built to withstand the elements and keep you on track with your goals.</p>
      </div>
    </div>
    <div class="carousel-item">
      <img src="../static/images/casual_watch.jpg" class="d-block w-100" alt="...">
      <div class="carousel-caption d-none d-md-block">
        <h5>Casual Watch</h5>
        <p> Elevate your everyday look with our Casual Watch collection. Designed for versatility and comfort, these watches seamlessly blend with your daily attire, offering both style and functionality for any occasion.</p>
      </div>
    </div>
  </div>
  <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide="prev">
    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
    <span class="visually-hidden">Previous</span>
  </button>
  <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide="next">
    <span class="carousel-control-next-icon" aria-hidden="true"></span>
    <span class="visually-hidden">Next</span>
  </button>
</div>



<section class="categories py-5">
  <div class="container">
    <h2 class="text-center mb-4">Explore Categories</h2>
    <div class="row text-center">
      <div class="col-md-4">
        <div class="card h-100">
          <img src="../static/images/luxury_watches.jpg" class="card-img-top" alt="Luxury Watches">
          <div class="card-body">
            <h5 class="card-title">Luxury Watches</h5>
            <a href="#shop" class="btn btn-outline-primary">Shop Now</a>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card h-100">
          <img src="../static/images/sport_watches.webp" class="card-img-top" alt="Sports Watches">
          <div class="card-body">
            <h5 class="card-title">Sports Watches</h5>
            <a href="#shop" class="btn btn-outline-primary">Shop Now</a>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card h-100">
          <img src="../static/images/casual_watches.jpg" class="card-img-top" alt="Casual Watches">
          <div class="card-body">
            <h5 class="card-title">Casual Watches</h5>
            <a href="#shop" class="btn btn-outline-primary">Shop Now</a>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<section class="testimonials py-5 bg-light">
  <div class="container">
    <h2 class="text-center mb-4">What Our Customers Say</h2>
    <div id="carouselTestimonials" class="carousel slide" data-mdb-ride="carousel">
      <div class="carousel-inner">
        <div class="carousel-item active">
          <div class="testimonial text-center">
            <img src="../static/images/john_doe.jpg" alt="Customer" class="rounded-circle mb-3" width="100" height="100">
            <h5 class="mb-1">John Doe</h5>
            <p class="text-muted">"Amazing collection! The watch I bought exceeded my expectations."</p>
          </div>
        </div>
        <div class="carousel-item">
          <div class="testimonial text-center">
            <img src="../static/images/jane_smith.jpg" alt="Customer" class="rounded-circle mb-3" width="100" height="100">
            <h5 class="mb-1">Jane Smith</h5>
            <p class="text-muted">"Excellent service and fast shipping. I love my new watch!"</p>
          </div>
        </div>
      </div>
      <a class="carousel-control-prev" href="#carouselTestimonials" role="button" data-mdb-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Previous</span>
      </a>
      <a class="carousel-control-next" href="#carouselTestimonials" role="button" data-mdb-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Next</span>
      </a>
    </div>
  </div>
</section>


<section class="cta py-5 text-white text-center" style="background-color: #343a40;">
  <div class="container">
    <h2 class="mb-4">Exclusive Limited-Time Offer</h2>
    <p class="lead">Save up to 50% on select watches. Offer ends soon!</p>
    <a href="#shop" class="btn btn-warning btn-lg">Shop Now</a>
  </div>
</section>

<section class="blog py-5" id="shop">
  <div class="container">
    <h2 class="text-center mb-4">Our Products</h2>
    <div class="container mt-4 h-100">
    {% if watches %}
      <div class="row">
        {% for watch in watches %}
        <!-- Product Card -->
        <div class="col-lg-3 col-md-4 col-sm-6 mb-4">
            <div class="card h-100 position-relative">
                {% if watch.status == 'Active' %}
                <div class="badge-sale">Sale</div> <!-- Optional Badge -->
                {% endif %}
                <div class="product-image">
                    {% if watch.image %}
                        <img src="{{ url_for('views.product_image', product_id=watch.id) }}" alt="{{ watch.model_name }}">
                    {% else %}
                        <p>No Image</p>
                    {% endif %}
                </div>
                <div class="card-body">
                    <h5 class="card-title">{{ watch.model_name }}</h5>
                    <p class="card-text text-muted">${{ watch.price }}</p>
                    <p class="card-text small">{{ watch.description | truncate(30, True, '...') }}</p>
                    <div class="star-rating">
                        ★★★★☆ <!-- Placeholder for star rating -->
                    </div>
                    <div class="mt-3">
                        {% if watch.status == 'Active' %}
                        {% if current_user.is_authenticated %}
                            <button class="btn btn-primary btn-sm mb-2 add-to-cart-btn" 
                                    data-watch-id="{{ watch.id }}"
                                    onclick="addToCart(this)">Add to Cart</button>
                        {% else %}
                            <button class="btn btn-primary btn-sm mb-2" 
                                    onclick="redirectToLogin()">Add to Cart</button>
                        {% endif %}
                        <a href="{{ url_for('views.product_details', product_id=watch.id) }}" class="btn btn-secondary btn-sm mb-2">View Details</a>
                        {% else %}
                        <a href="/login" class="btn btn-secondary btn-sm mb-2">Add to Cart</a>
                        <a href="{{ url_for('views.product_details', product_id=watch.id) }}" class="btn btn-secondary btn-sm mb-2">View Details</a>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}
      </div>
    {% else %}
      <p>No Products Available.</p>
    {% endif %}
    </div>
  </div>
</section>
    



<!-- Pagination -->
<nav aria-label="Product pagination">
  <ul class="pagination justify-content-center">
      <!-- Previous Page Link -->
      <li class="page-item {% if not watches.has_prev %}disabled{% endif %}">
          <a class="page-link" href="{{ url_for('views.home', page=watches.prev_num) }}">Previous</a>
      </li>

      <!-- Page Numbers -->
      {% for page_num in watches.iter_pages() %}
      <li class="page-item {% if page_num == watches.page %}active{% endif %}">
          <a class="page-link" href="{{ url_for('views.home', page=page_num) }}">{{ page_num }}</a>
      </li>
      {% endfor %}

      <!-- Next Page Link -->
      <li class="page-item {% if not watches.has_next %}disabled{% endif %}">
          <a class="page-link" href="{{ url_for('views.home', page=watches.next_num) }}">Next</a>
      </li>
  </ul>
</nav>



<section class="blog py-5">
  <div class="container">
    <h2 class="text-center mb-4">From Our Blog</h2>
    <div class="row">
      <div class="col-md-4">
        <div class="card">
          <img src="../static/images/blog.jpg" class="card-img-top" alt="Blog Title">
          <div class="card-body">
            <h5 class="card-title">How to Choose the Perfect Watch</h5>
            <p class="card-text">Learn tips and tricks for selecting the best watch that suits your style and budget.</p>
            <a href="#" class="btn btn-outline-primary">Read More</a>
          </div>
        </div>
      </div>
      <div class="col-md-4">
        <div class="card">
          <img src="../static/images/blog2.avif" class="card-img-top" alt="Blog Title">
          <div class="card-body">
            <h5 class="card-title">Watch Maintenance Tips</h5>
            <p class="card-text">Keep your watch looking brand new with these simple maintenance tips.</p>
            <a href="#" class="btn btn-outline-primary">Read More</a>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<section class="newsletter py-5 bg-dark text-white">
  <div class="container text-center">
    <h2 class="mb-4">Stay Updated</h2>
    <p>Subscribe to our newsletter and get the latest updates on new arrivals and exclusive deals.</p>
    <form class="form-inline justify-content-center">
      <input type="email" class="form-control mb-2 mr-sm-2" placeholder="Enter your email">
      <button type="submit" class="btn btn-primary mb-2">Subscribe</button>
    </form>
  </div>
</section>

<style>
  .card {
      border: none;
      border-radius: 15px; /* Rounded corners */
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); /* Soft shadow */
      overflow: hidden; /* Ensure corners are rounded */
  }
  .card-img-top {
      object-fit: cover; /* Ensure the image covers the card area */
      height: 200px; /* Fixed height for uniformity */
  }
  .star-rating {
      color: gold; /* Star color */
      font-size: 1rem; /* Adjust star size */
  }
  .badge-sale {
      position: absolute;
      top: 10px;
      left: 10px;
      background-color: red;
      color: white;
      padding: 5px 10px;
      border-radius: 5px;
      font-size: 0.8rem;
  }
  .card-body {
      text-align: center;
  }

  .product-image {
    width: 100%; /* Full width of the card */
    height: 200px; /* Fixed height */
    overflow: hidden; /* Hide overflow to maintain fixed size */
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .product-image img {
      width: 100%; /* Adjust image to fit container width */
      height: 100%; /* Adjust image to fit container height */
      object-fit: cover; /* Cover the container, keeping aspect ratio */
      display: block; /* Remove extra space below image */
  }

  @media (max-width: 767.98px) {
      .card-img-top {
          height: 150px; /* Adjust height on small screens */
      }
  }
</style>

<script>
  function addToCart(button) {
      var watchId = button.getAttribute('data-watch-id');
      
      // Show the loading spinner
      document.getElementById('loading-spinner').style.display = 'flex';

      fetch('/add_to_cart', {
          method: 'POST',
          headers: {
              'Content-Type': 'application/json',
          },
          body: JSON.stringify({ watch_id: watchId })
      })
      .then(response => response.json())
      .then(data => {
          // Hide the loading spinner
          document.getElementById('loading-spinner').style.display = 'none';
          
          if (data.error) {
              alert(data.error);
          } else {
              // Update the cart count on the page
              updateCartCount(data.cart_count);
          }
      })
      .catch(error => {
          console.error('Error:', error);
          // Hide the loading spinner in case of an error
          document.getElementById('loading-spinner').style.display = 'none';
      });
  }

  function updateCartCount(count) {
      var cartButton = document.querySelector('.btn-success');
      if (cartButton) {
          cartButton.innerHTML = `
              <img src="../static/images/cart-fill.svg" alt="Icon" style="width: 16px; height: 16px; filter: invert(1);">
              ${count} Items In Your Cart
          `;
      }
  }

  // Update cart count on page load
  document.addEventListener('DOMContentLoaded', function() {
      fetch('/cart_count')
          .then(response => response.json())
          .then(data => updateCartCount(data.cart_count))
          .catch(error => console.error('Error:', error));
  });
</script>

<script>
  function redirectToLogin() {
      window.location.href = '/login';
  }
</script>

{% endblock %}
